{
  "hooks": {
    "PreCompact": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "IMPORTANT: Context compaction is about to occur. Before it happens, save all conversation state to persistent memory. Follow these steps in order:\n\n1. Dispatch the memory-manager agent to update all memory files in .claude/memory/ (users.md, topics.md, relationships.md, action-items.md) with context from the current conversation. Pass the current CLAUDEBOT_LOG_LEVEL to the agent.\n\n2. After memory-manager completes, relay any LOG: entries from its output to the log file via Bash (source log-lib.sh and write qualifying entries).\n\n3. Dispatch the personality-evolver agent to absorb a new personality trait from a randomly selected recent chat participant. Pass the current CLAUDEBOT_LOG_LEVEL to the agent.\n\n4. After personality-evolver completes, relay any LOG: entries from its output to the log file.\n\n5. Confirm both agents have completed before allowing compaction to proceed.\n\nThis is critical - any conversation context not saved to memory files will be lost during compaction."
          }
        ]
      }
    ]
  }
}
